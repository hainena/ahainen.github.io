<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <style>
      @font-face {
        font-family: "AngerFoot";
        src: url("docs/font/Anger-Foot.woff") format("woff");
        font-weight: normal;
        font-style: normal;
      }

      img {
        position: absolute;
      }

      * {
        font-family: "AngerFoot", sans-serif;
        color: #f11672;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        background: transparent;
      }

      #sep {
        margin: -5px;
      }

      #clock {
        font-size: 72px;
        letter-spacing: -12px;
        left: 230px;
        top: 100px;
        position: absolute;
        text-shadow: -6px 6px 0px black;
        z-index: 2;
      }

      .bullet {
        width: 60px;
        align-self: center;
        position: relative;
      }

      /* The kick animation layer (hidden until triggered) */
      #kickAnimWrap {
        position: absolute;
        inset: 0;
        z-index: 1;
        pointer-events: none;
      }
      #kickAnimWrap img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        left: 0;
        top: 0;
      }
    </style>
  </head>

  <body>
    <div id="clock">
      <span id="hh">12</span><span id="sep">!</span><span id="mm">00</span>
    </div>

    <div
      style="
        display: flex;
        flex-direction: row;
        position: absolute;
        bottom: 64px;
        left: 80px;
        gap: 24px;
      "
    >
      <img src="docs/bullet.svg" class="bullet" />
      <img src="docs/bullet.svg" class="bullet" />
      <img src="docs/bullet.svg" class="bullet" />
      <img src="docs/bullet.svg" class="bullet" />
      <img src="docs/bullet.svg" class="bullet" />
      <img src="docs/bullet.svg" class="bullet" />
    </div>

    <img src="docs/time.svg" style="width: 400px; top: 76px; left: 80px" />
    <img
      src="kick.svg"
      style="width: 440px; bottom: 72px; left: 50%; transform: translateX(-50%)"
    />

    <div id="kickAnimWrap">
      <img id="kickAnim" alt="kick" />
    </div>

    <script>
      // --- clock ---
      const hhEl = document.getElementById("hh");
      const mmEl = document.getElementById("mm");
      const sepEl = document.getElementById("sep");

      function pad2(n) {
        return String(n).padStart(2, "0");
      }

      function updateClock() {
        const now = new Date();
        let h = now.getHours();
        const m = now.getMinutes();
        h = h % 12;
        if (h === 0) h = 12;
        hhEl.textContent = String(h);
        mmEl.textContent = pad2(m);
      }
      sepEl.style.visibility = "visible";
      updateClock();
      setInterval(updateClock, 2000);

      let kickImg = document.getElementById("kickAnim");
      let kickBlobUrl = null;

      const COOLDOWN_MS = 200;
      let lastKickAt = 0;

      (async function preloadKick() {
        const res = await fetch("docs/kick-once.webp", { cache: "force-cache" });
        const blob = await res.blob();
        kickBlobUrl = URL.createObjectURL(blob);

        kickImg.src = kickBlobUrl;
        kickImg.decoding = "async";
      })();

      function playKickOnce() {
        const now = Date.now();
        if (now - lastKickAt < COOLDOWN_MS) return;
        lastKickAt = now;

        if (!kickBlobUrl) return;

        const fresh = document.createElement("img");
        fresh.id = "kickAnim";
        fresh.alt = "kick";
        fresh.decoding = "async";
        fresh.src = kickBlobUrl;

        kickImg.replaceWith(fresh);
        kickImg = fresh;
      }

      // Optional cleanup
      window.addEventListener("beforeunload", () => {
        if (kickBlobUrl) URL.revokeObjectURL(kickBlobUrl);
      });

      // --- realtime: Supabase Broadcast ---
      // Fill these in:
      const SUPABASE_URL = "https://rcwvicblzidaukglxquu.supabase.co";
      const SUPABASE_ANON_KEY = "sb_publishable_7to8QZuk22ORD8SnfiSRjg_U7f7EeQ0";

      // Optional: change these names; just keep them consistent across both pages.
      const CHANNEL = "angerfoot-kick";
      const EVENT = "kick";

      (async () => {
        const { createClient } =
          await import("https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm");
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
          realtime: { params: { eventsPerSecond: 20 } },
        });

        const channel = supabase.channel(CHANNEL);

        channel.on("broadcast", { event: EVENT }, (payload) => {
          // payload.payload can include data if you want
          playKickOnce();
        });

        const { error } = await channel.subscribe((status) => {
          // status: SUBSCRIBED, TIMED_OUT, CLOSED, CHANNEL_ERROR
          // If you want: console.log("Realtime status:", status);
        });

        if (error) console.error("Realtime subscribe error:", error);
      })();
    </script>
  </body>
</html>
